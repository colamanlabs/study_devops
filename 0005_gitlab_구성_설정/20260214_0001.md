## gitlab 작업 내용 정리
### 2026.02.14

```aiignore
비식별화 적용
- IP
- 사용자명
```

### 1. gitiab 설치여부 점검
```aiignore
apt list --installed 명령어로 확인한다. 

apt list 
-> 모든 패키지 리스트

apt list --installed
-> 설치된 패키지만 출력 

root@D3-VM-DEV-01:/home/**********# apt list --installed | grep gitlab

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

gitlab-ce/noble,now 18.8.4-ce.0 amd64 [설치됨]
root@D3-VM-DEV-01:/home/**********#
```


### 2. gitlab 기동여부 점검
```aiignore
gitlab-ctl status 로 확인한다. 

root@D3-VM-DEV-01:/home/**********# gitlab-ctl status
run: alertmanager: (pid 1472) 342s; run: log: (pid 1464) 342s
run: gitaly: (pid 1468) 342s; run: log: (pid 1459) 342s
run: gitlab-exporter: (pid 1487) 342s; run: log: (pid 1473) 342s
run: gitlab-kas: (pid 1471) 342s; run: log: (pid 1466) 342s
run: gitlab-workhorse: (pid 1467) 342s; run: log: (pid 1460) 342s
run: logrotate: (pid 1478) 342s; run: log: (pid 1458) 342s
run: nginx: (pid 1462) 342s; run: log: (pid 1461) 342s
run: node-exporter: (pid 1474) 342s; run: log: (pid 1463) 342s
run: postgres-exporter: (pid 1494) 342s; run: log: (pid 1491) 342s
run: postgresql: (pid 1488) 342s; run: log: (pid 1486) 342s
run: prometheus: (pid 1493) 342s; run: log: (pid 1492) 342s
run: puma: (pid 1495) 342s; run: log: (pid 1479) 342s
run: redis: (pid 1470) 342s; run: log: (pid 1465) 342s
run: redis-exporter: (pid 1476) 342s; run: log: (pid 1469) 342s
run: sidekiq: (pid 1490) 342s; run: log: (pid 1477) 342s
root@D3-VM-DEV-01:/home/**********# 
```



### 3. gitlab 웹 UI 설치포트 확인 
```aiignore
/etc/gitlab/gitlab.rb 파일에서 확인한다.
rb 파일은 ruby 스크립트 파일 확장자명이다. 

root@D3-VM-DEV-01:/etc/gitlab# pwd
/etc/gitlab
root@D3-VM-DEV-01:/etc/gitlab# ls -al ./gitlab.rb 
-rw------- 1 root root 160382 12월 27 19:28 ./gitlab.rb
root@D3-VM-DEV-01:/etc/gitlab# grep -a "external_url" ./gitlab.rb | egrep -v "#"
external_url 'http://***.***.***.***'
root@D3-VM-DEV-01:/etc/gitlab# 

디폴트 포트 80 이다.

웹브라우져를 열고 주소를 external_url 값으로 접속한다.
http://***.***.***.***/ 로 확인한다.
```


### 4. gitlab 디폴트 포트 변경

#### 4.1 AS-IS 포트 확인(gitlab.rb) 
```aiignore
root@D3-VM-DEV-01:/etc/gitlab# pwd
/etc/gitlab
root@D3-VM-DEV-01:/etc/gitlab# ls -al ./gitlab.rb 
-rw------- 1 root root 160382 12월 27 19:28 ./gitlab.rb
root@D3-VM-DEV-01:/etc/gitlab# grep -a "external_url" ./gitlab.rb | egrep -v "#"
external_url 'http://***.***.***.***'
root@D3-VM-DEV-01:/etc/gitlab# 
디폴트 포트 80 이다.
```

#### 4.2 gitlab.rb 파일에서 external_url 변경
```
디폴트 포트 80 이다.
19080 으로 변경한다.

root@D3-VM-DEV-01:/etc/gitlab# diff ./gitlab.rb ./gitlab.rb.20260214_100000 
32c32
< external_url 'http://***.***.***.***:19080'
---
> external_url 'http://***.***.***.***'
root@D3-VM-DEV-01:/etc/gitlab# 
```

#### 4.3 gitlab-ctl reconfigure 로 서비스 재구성
```
gitlab 서비스는 nginx 기반으로 설행된다.

ps 로 확인하면 직접 설치하지 않은 nginx 프로세스가 같이 보인다.

root@D3-VM-DEV-01:/etc/gitlab# ps -ef | grep -v grep | grep nginx
root        1442    1437  0 09:55 ?        00:00:00 runsv nginx
root        1461    1442  0 09:55 ?        00:00:00 svlogd -tt /var/log/gitlab/nginx
root        1462    1442  0 09:55 ?        00:00:00 nginx: master process /opt/gitlab/embedded/sbin/nginx -p /var/opt/gitlab/nginx
gitlab-+    1549    1462  0 09:55 ?        00:00:00 nginx: worker process
gitlab-+    1550    1462  0 09:55 ?        00:00:00 nginx: worker process
gitlab-+    1551    1462  0 09:55 ?        00:00:00 nginx: worker process
gitlab-+    1552    1462  0 09:55 ?        00:00:00 nginx: worker process
gitlab-+    1555    1462  0 09:55 ?        00:00:00 nginx: cache manager process
root@D3-VM-DEV-01:/etc/gitlab# 

./gitlab.rb 파일에 적용한 내용으로 다시 nginx 구성을 해야 하므로 reconfigure 가 필요하다. 


gitlab-ctl reconfigure
이때 표준출력으로 여러 메세지가 나온다.
오래걸린다. (4 CPU VM 에서 2 CPU 100% 이고 1분 정도 지속)
 
root@D3-VM-DEV-01:/etc/gitlab# gitlab-ctl reconfigure
[2026-02-14T10:16:10+09:00] INFO: Started Cinc Zero at chefzero://localhost:1 with repository at /opt/gitlab/embedded (One version per cookbook)
Cinc Client, version 18.3.0
Patents: https://www.chef.io/patents
Infra Phase starting
[2026-02-14T10:16:10+09:00] INFO: *** Cinc Client 18.3.0 ***
[2026-02-14T10:16:10+09:00] INFO: Platform: x86_64-linux
[2026-02-14T10:16:10+09:00] INFO: Cinc-client pid: 3084
...
...
이때 표준출력으로 여러 메세지가 나온다.
...
...
[2026-02-14T10:17:04+09:00] INFO: Cinc Client Run complete in 52.246875504 seconds

Running handlers:
[2026-02-14T10:17:04+09:00] INFO: Running report handlers
Running handlers complete
[2026-02-14T10:17:04+09:00] INFO: Report handlers complete
Infra Phase complete, 10/897 resources updated in 53 seconds
gitlab Reconfigured!
root@D3-VM-DEV-01:/etc/gitlab# 
```


#### 4.4 서비스 재시작 및 웹 브라우져로 새 주소 접속 
```
gitlab-ctl restart


root@D3-VM-DEV-01:/etc/gitlab# gitlab-ctl restart
ok: run: alertmanager: (pid 4052) 1s
ok: run: gitaly: (pid 4062) 0s
ok: run: gitlab-exporter: (pid 4085) 0s
ok: run: gitlab-kas: (pid 4098) 0s
ok: run: gitlab-workhorse: (pid 4108) 1s
ok: run: logrotate: (pid 4121) 0s
ok: run: nginx: (pid 4127) 1s
ok: run: node-exporter: (pid 4135) 1s
ok: run: postgres-exporter: (pid 4141) 0s
ok: run: postgresql: (pid 4151) 1s
ok: run: prometheus: (pid 4159) 0s
ok: run: puma: (pid 4171) 0s
ok: run: redis: (pid 4176) 1s
ok: run: redis-exporter: (pid 4184) 0s
ok: run: sidekiq: (pid 4199) 1s
root@D3-VM-DEV-01:/etc/gitlab# 

웹브라우져 열고 변경된 주소로 접속해서 로그인창이 얼려는지 확인한다.

http://***.***.***.***:19080/users/sign_in
```




### 5. 관리자 비번 재설정 및 확인 
```aiignore
설치직후에는 /etc/gitlab/initial_root_password 에 있으나, 확인결과 없다. 
일정시간이 지나면 파일이 삭제된다고 한다.

root@D3-VM-DEV-01:/etc/gitlab# pwd
/etc/gitlab
root@D3-VM-DEV-01:/etc/gitlab# cat /etc/gitlab/initial_root_password
cat: /etc/gitlab/initial_root_password: 그런 파일이나 디렉터리가 없습니다
root@D3-VM-DEV-01:/etc/gitlab# 


1. gitlab-rails console -e production 실행
좀 오래걸린다. (30초 ~ 1분)
root@D3-VM-DEV-01:/etc/gitlab# 
root@D3-VM-DEV-01:/etc/gitlab# gitlab-rails console -e production
--------------------------------------------------------------------------------
 Ruby:         ruby 3.2.8 (2025-03-26 revision 13f495dc2c) [x86_64-linux]
 GitLab:       18.8.4 (a11b8d53073) FOSS
 GitLab Shell: 14.45.5
 PostgreSQL:   16.11
------------------------------------------------------------[ booted in 35.65s ]
Loading production environment (Rails 7.2.3)
gitlab(prod)> 


2. gitlab-rails console -e production 에서 변경작업 진행
새 패스워드는 "newpassword1234!" 라고 가정
계정 잠김인 경우, 해제절차 필요하다. 

root@D3-VM-DEV-01:/etc/gitlab# gitlab-rails console -e production
--------------------------------------------------------------------------------
 Ruby:         ruby 3.2.8 (2025-03-26 revision 13f495dc2c) [x86_64-linux]
 GitLab:       18.8.4 (a11b8d53073) FOSS
 GitLab Shell: 14.45.5
 PostgreSQL:   16.11
------------------------------------------------------------[ booted in 35.65s ]
Loading production environment (Rails 7.2.3)
gitlab(prod)> 
gitlab(prod)> user = User.find_by_username('root')
=> #<User id:1 @root>
gitlab(prod)> 
gitlab(prod)> user
=> #<User id:1 @root>
gitlab(prod)> 
gitlab(prod)> user.password = 'newpassword1234!'
=> "newpassword1234!"
gitlab(prod)> user.password_confirmation = 'newpassword1234!'
=> "newpassword1234!"
gitlab(prod)> user.save!
=> true
gitlab(prod)> user.state
=> "active"
gitlab(prod)> user.activate
=> false
gitlab(prod)> user.state
=> "active"
gitlab(prod)> user.save!
=> true
gitlab(prod)> exit
root@D3-VM-DEV-01:/etc/gitlab#


3. 로그인
http://***.***.***.***:19080/

새 계정정보로 로그인하고 정상여부 확인한다.


4. 비번변경 
- 로그인하고
- 우측 상단 아이콘 클릭하고, "Preferences" 선택 
- 좌측 패널 메뉴(User settings) 에서 "Password" 선택 
- 새 비밀번호 입력후 "Save password" 선택
- ( 자동으로 로그아웃된다. )
- 새 비밀번호로 로그인한다.
```


### 6. 전용 어드민 계정 생성
```aiignore

1. 우측 상단 어드민 아이콘 옆 스패너 아이콘 있는 "Admin" 선택
선택하면 "Admin Area" 로 전환된다.

2. 계정생성
Admin Area → Users → New user
- Name: 관리자 이름
- Username: admin 계정 ID
- Email: 관리자 이메일

3. 로그인1
- 비밀번호를 변경한다.

4. 로그인2
- 최종 비밀번호로 로그인한다.
```


### 7. 사용자 계정생성
```aiignore

1. 어드민 계정으로 로그인

2. 계정생성
Admin Area → Users → New user
- 최초 비밀번호를 설정한다.
```


### -- 끝 --
